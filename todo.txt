________TO DO__________
- продумать вариант чтения X-GNOME-Autostart-enabled=fals/true из .desktop файтов в каталоге ~/.config/autostart

________TO DO (ON HOLD)__________
- DAEMON-INSTALL_STORY — solution 5??? - on hold
- попробовать сделать статусную простынку как субменю в строке статуса. Тут есть один неприятный нюанс - обновление статуса (в националной локали) нужно выполнять по открытию этой простынки (обновлять каждый раз - ИМХО неоправданно накладно), но пока не понятно как вызвать некое действие по открытию подменю...

________CANCELED________
- Добавить скрипт установки демона в preinst скрипт пакета — NGI (DAEMON-INSTALL_STORY) - CANCELED

________Known bugs/issues/stories:_________
ICON_RESIZE_BUG: (ON HOLD)
- не масштабируются иконки в панели gnome-fallback и XFCE (начиная с Xubuntu 14.04)
Возможно ошибки/недоработки в библиотеках gnome-fallback— что с этим делать — не ясно (нет тестовой платформы). 
В Xubuntu вроде как баг есть — разрабы не хотят фиксить — что делать — тоже пока не ясно.
Временное решение (1.3.1+) - иконки отмасштабированы под классический размер панели (24х24)

DAEMON-INSTALL_STORY: (ON HOLD)
- Не понятно как добиться установки демона вместе с (из) индикатора (вариант установки индикатора вместе с демоном - Not in this universe!)
Возможные решения:
1. Поставить по зависимостям — нельзя т. к. репозитрий YD на чистой машине не добавлен. По неудовлетворенным зависимостям установка упадет. - Not a good idea!
2. Добавить репу в процессе инсталяции — можно, но из него ничего не поставится без apt-get update (который во время установки пакета запустить не удастся из за того, что уже залочены ресурсы пакетного менеджера) - Not a good idea!
3. Ставить из индикатора: нужны права рута — в разных DE разные GUI морды для SUDO, а запускать в терминале (через просто sudo) — как то некрасиво. — Not a good idea!
4. Включить пакет индикатора в общий пакет с демоном — требуется определенная кооперация со стороны Yandex — Not in this universe!
5. Забить и записать как требования к установке - Looks as a good idea :)
6. В preinst скрипте DEB пакета залить wget-ом DEB yandex-disk и поставить его - не получилось т.к. пакетная база залочена и не удается поставить пакет из preinst скрипта
Решение: пока 5.
Результат: нет

______FIXED issues/improvemnts:_____
- Переделал работу с параметрами командной строки на стандартную библиотеку argparse:
  + простота добавления новых параметров вызова и гибкость в формате их записи (ест и '-с10' и '-с 10')
  + автоматическая генерация вывода онлайн-справки (вызов с ключем -h) и текста "Usage" при ошибках в переданных опциях запуска.
  + вывод версии не всегда а только по ключу -v (без запуска индикатора) + вывод версии в logging.info() при нормальном запуске.
  + ноовый параметр -с <path> - для указания конфигурации демона.
- реализовал вариант (new branch multidisk) запуск нескольких экзкмпляров индикатора с несколькими экземплярами демонов с разными конфигами. Это потребовало следующие переделки:
  * <patth/to/config> - получать через параметр -c командной строки + разворачивать в нем '~' в абсолютный путь 
  * PID файл создавать с именем pid_<patth_to_config> 
  * поиск мертвого демона вести с указанием '--dit=<patth_YD_folder>' + убрать из поиска текущего пользователя + убивать мертвичину по найденым pid
  * запуск и останов демона: yandex-disk -c <patth/to/config> start|stop
  * статус: yandex-disk -c <patth/to/config> status
FIXED 1.7.0
- в 16.04 ругань на версии (раньше ее не было): sys:1: PyGIWarning: AppIndicator3 was imported without specifying a version first. Use gi.require_version('AppIndicator3', '0.1') before import to ensure that the right version gets loaded.
sys:1: PyGIWarning: Notify was imported without specifying a version first. Use gi.require_version('Notify', '0.7') before import to ensure that the right version gets loaded.
Прописал как просили.
- при переделке обработки галочки в настройках (1.6.4) сделал ошибку, приводившую к неадекватному поведению при смене тем иконок (и других настроек) - пофиксил.
- Переделал работу с конфигурационными файлам с использованием регулярных выражений, это решилло сразу несколько моментов:
  +\- файл не переписывается целиком, в нем только меняются строки с изменяемыми значениями. Это несколько медлеенее, но т.к. обновление происходет в буфере, то это не заметно - это сотые доли секунды;
  + пустые строки и комментарии не хранятся во внутренней структуре;
  + при обновлении файла, порядок во внутренней структуре не имеет значения, что позволило отказаться от OrderedDict (и фикса к неработающему методу setdefault).
FIXED 1.6.5
- переделал функцию разбора вывода демона с использоваением регулярных выражений: код в 2 раза медлеенее(что не важно при времени порядка 10^-5), но в 2 раза короче и легче сопровождаем.
- BUG - ошибка в коде при правке файловых расширений
- Уточнение по адресам поддержки (меню Help)
FIXED 1.6.4 dev, master, realize
- если активация/дизактивация файловых расширений не удалась - чекбокс в настройках не меняет свое состояние.
- добавлены файловые расширения для Pantheon-files
FIXED 1.6.3 dev, master, realize
- BUG - ошибка в коде при правке переводов 1.6.2 - краш индикатора.
FIXED 1.6.2 dev, master, realize + launcpad
- Слетели несколько переводов
FIXED 1.6.1 dev, master, realize + launcpad
- Logging level via command line: Уровень отладки устанавливается через параметр запуска из командной строки -l<n>, где <n> - один из уровней отладки: 10, 20, 30, 40 или 50. Параметр loglevel убран из конфигурационного файла. 
FIXED 1.6.0 dev, master, realize + launcpad
- preinst script changed: убрал из скрипта DEB пакета код по удалению dconf схемы настроек.
- preinst и prerm скрипты: изменен код по поиску и убиению индикаторов.
FIXED 1.5.5 dev, master, precise, realize + launcpad
- добавил поддержку multi-user: переместил lock файл из /tmp/ в /home/<user>/.config/yd-tools/pid
FIXED 1.5.4 master, precise, realize + launcpad
- Реализовал уродский синтаксис для значения exclude-dirs: сначала в ковычках, а потом (внутри) значения через запятую - ну не уроды ли в яндыксе работают такой корявый синтаксис в конфигах использовать!!!!
FIXED 1.5.2 master, realize + launcpad
- Добавил возможность сохранять пустые строки и комментирии при записи конфигурационного файла.
- Заменил унаследованный из grive-tools функционал вывода отладочной информации на стандартный модуль logging. Теперь можно задать несколько уровней вывода сообщений, и с небольшими доработками можно писать логи в файлы или в системный логгер (но с этим надо еще разобраться)
- Код переписан из структурного в концепцию ООП (без особого фанатизма - в некоторых местах оставлены процедурные решения для простоты).
- Значительно переработан метод чтения конфигурационных файлов.
- Конфигурационные файлы (приложения и демона) записываются на выходе из настроек только в том случае если соответсвующие им настройки были изменены.
FIXED 1.5.1 dev -> master 
- Добавления в русский перевод (для нового функционала).
- Реализовать возможность выборочной синхронизации. Нужен отдельный диалог для выбора отдельных директорий, которые не надо синхронизировать (опция —exclude-dirs=DIR1,DIR2,...). Реализованный вариант: Плоский список директорий. Добавлять стандартным диалогом выбора файла/каталога. Удаление через предварительный выбор строк (checkbox на каждой строке).
- Поддержка списка значений в конфигурационных файлах (четние и запись).
FIXED 1.5.0 dev
- BUG_FIX с окном About - конструктор этого диалога не есть названия.
FIXED 1.4.2a percise и 1.4.3 master
- Что-то не то с файловыми расширениями для Thunar (продублировались пункты меню). Продублировались при переходе на переведенную версию.
NOTHING TO FIX
- Окончательно перейти на Python3 ибо городить огород над совместимостью с Python2 уже сильно напрягает :( Однако это означает заморозку версии для Ubuntu 12.04 Precise (т. к. под precise нет библиотеки pinotify для Python3). см. PY-2_PERCISE_STORY
FIXED 1.4.2 percise (Python2) и 1.4.3+ master и dev (Python3)
- переделал сохранение настроек согласно концепции USER_LOCAL_SETTINGS + настраиваемые пользователем иконки
FIXED 1.4.2 master, realize + launcpad
- переделал чтение и обработку конфигурационного файла демона (используется промежуточный dict)
FIXED 1.4.2 master, realize + launcpad
- перенос проетка из /opt/yd-tools в /usr/share/yd-tools, а также размещение основного python кода непосредствено в /usr/bin/yandex-disk-indicator (вместо баш-вызывалки) - FILES_LOCATIONS_STORY
FIXED 1.4.0 - 1.4.1 master, realize + launcpad
- переделать работу с .desktop файлами: брать .desktop для автозапуска из /usr/share/application/ и убрать их из /opt/yd-tools. Сами .desktop названы универсально, что бы имя подходило и для меню и для автозапуска.
FIXED 1.3.1d master, realize + launcpad
- одолеть возникший баг на ланчпаде — пакеты не собираются (с работы заливка на ланчпад залочена — разобраться можно только дома) - все получилось, но что было - не понял.
FIXED 1.3.1a
- Оптимизация и правка оформления кода (PEP8) и комментариев 
FIXED 1.3.1 
- Динамическое меню для последних синхронизированных т. к. песледняя версия демона показывает только те последние синхронизированные, которые были синхронизированы в ходе последней сессии запуска демона. Подменю обновляется только при изменении списка выдаваемого демоном. FIXED ver 1.3.1(dev)
FIXED 1.3.1
- Залил исходники на Github
- Добавил диалог с отображением вывода 'портянки' от демона (fix for ACCESS_ERROR_STORY). VER 1.2.0
- Чтение конфиг файла для определения каталога ЯД
- Чтение конфиг файла как с кавычками так и без
- Небольшое изменение в логике обработки статусов 
FIXED 1.3.0 (github realize)
- Переделал запуск — индикатора может запускаться с не запущенным демоном (но демон должен быть установлен и настроен), + добавлена настройка — запускать демона при старте.
FIXED 1.1.9
- Переделал наблюдателя за изменением файла из асинхронного (в отдельном потоке) на обычный (в текущем потоке), который вызывается по таймеру (GTK event based model)
FIXED 1.1.9
- При названии YD фолдера по русски — ошибки ascii/UTF-8 в питоне 2.7
FIXED 1.1.8 (1.1.91)
- Добавить настройки запуска демона --read-only и --overwrite
FIXED 1.1.6
- Переделал окно настроек:
  1. настройки индикатора и демона разнесены на разные закладки, 
  2. изменен тип окна на диалог (что бы кнопка 'закрыть' имела нормальный вид)
FIXED 1.1.6
- Исправление недочета: окно настроек можно было открыть несколько раз т. к. пункт меню не дизактивировался на время открытия окна (правильно было сделано с для окна about). - FIXED 1.1.6
- Убрал двойную ошибку при открытии из последних синхронизированных файла/пути, которые были переименованы и более не существуют (кликнуть такие файлы\каталоги — нельзя, они не чувствительны).
FIXED 1.1.6
- допилить расширения для Dolphin (под кеды), на основе http://habrahabr.ru/post/212763/ 
FIXED 1.1.5
- CRUSH_CASE. Убрал в вызовах subprocess.check_output опцию shell=True и перевел выбор NLS через вызов os.putenv('LANG','en_US.UTF-8'). Возможно это решение для HARON_CASE2
FIXED (1.1.5) 
- перевел десктоп-нотификацию на работу через библиотеку python вместо использования команды оболочки notify-send. Это устраняет появление множества (более одного) уведомлений в ходе быстро-меняющихся процессов.
FIXED (1.1.5) 
- Убран обнаруженный глюк (v.1.1.3): при запуске не из терминала перестали открываться файлы/каталоги из последних синхронизированных (Xubuntu 12.04). Оказалось это как-то связано (не до конца понял — как???) с отсутствием потока для вывода отладочной информации (отключение отладки решало эту проблему). Убрал печать отладочной инфы в try: except: блок.
FIXED (1.1.5)
- Fixed story:демон может работать в фоне, но отвечать, что он не загружен (HARON_CASE- confirmed). Это приводит (по старому алгоритму индикатора) к запуску второй версии демона и странным последствиям. Причин такого поведения установить не удалось.
FIXED (1.1.3)
- Исправление ситуации с отсутствием в меню последних синхронизированных символа <_> (а также возникновения акселераторов в меню): см MENU-ACCELERATOR_STORY.
FIXED (1.1.3)
- Исправление ошибки в отображении имени файла (как и пр открытии) если в нем есть символ <'>
FIXED (1.1.3)
- Проверять то, что демон запущен как процесс и убивать его если он запущен, но не отвечает (HARON_CASE).
FIXED (1.1.3)
- Добавит скрипты проверки файловых менеджеров и добавления add-on-ов.
FIXED (1.1.2)
- Добавить скрипты snowdimon в сбоку и в yd-tools.install.
FIXED (1.1)
- Добавить копирайты snowdimon
FIXED beta
- Добавить скрипт настройки в вызов из диалога ошибки
FIXED beta
- Zenity обертка для yandex-disk setup — взялся делать snowdimon
FIXED beta
- Вызов установки из диалога об ошибке в случае не настроенного клиента.
FIXED beta
- Фикс пропадающего 'Status: '
FIXED beta
- корректировка настроек автостарта в зависимости от наличия шорткатов в ~/.confg/autostart  FIXED
- Пофиксить ошибки с урезанием пути/файла в списке последних синхронизированных для имен содержащих русские символы в названии (Unicode issue)
FIXED beta
- вернуть прямые пути к иконкам вариант с ind.set_icon_theme_path(path) не работает ни в Unity ни в KDE
FIXED beta
- динамическое изменение таймаута
FIXED beta
- обрезать длинные имена в суб-меню
FIXED beta
- Заливка на lanchpad
FIXED alfa
- ошибка с суб-меню (KDE)
FIXED alfa
- Вписать в deb зависимости. 
FIXED alfa
- Руссификация
FIXED alfa
- Оптимизация кода по смене иконок
FIXED alfa
- Не обновляются данные по размерам
FIXED alfa
- Отработка ошибки от упавшего демона (статус: failed to connect to daemon process)
FIXED alfa
- Отработка ошибок запуска демона без интернета (Error: Proxy server is unavailable.)
FIXED alfa
- Таймер+обработчик для проверки статуса в случае отсутствия сети
FIXED alfa
- Настройка "отключать демон при выключении индикатора по quit"
FIXED alfa
- Показ последних синхронизированных файлов в суб-меню
FIXED alfa
- Показ прогресса при синхронизации
FIXED alfa
- Преобразование/расшифровка статуса
FIXED alfa
- Fix menu issue on unity (много строк в одной позиции)
FIXED alfa

____________FIXED STORIES_______________
PY-2_PERCISE_STORY:
Поддержка Unicode в Python2 требует разных изощренных телодвижений. Более того даже константы unicode символов почему-то не могут быть записаны одинаково в Python3 и Python2 (обнаружил при тестировании 1.4.2 в голой Xubuntu 12.04 на виртуалке). Кроме этого в любой работе из Python2 с внешними источниками (gettext, subprocess, files) приходится применять .decode или другие выверты, что бы работать с utf-8. И фиг бы сними если бы Python3 требовал того-же или просто игнорировал эти "хитровывернутые телодвижения". Но Python3 работает с utf-8 без вывертов и на все выверты, необходимые для python2 ругается ексепшенами. Все это требует обрамлять такие места разночтений в условное ветвление по признаку версии Python. 
На момент тестирования 1.4.2 таких мест было 3:
 - .decode('utf-8') вывода демона в utf-8 строку (там названия файлов требуют uft-8)
 - .decode('utf-8') имени Yandex.disk каталога (он может быть назван по русски для примера, что тоже требует uft-8)
 - gettext - требуются разные версии функций работы с каталогом переводов в Python2 и Python3 (единообразного способа задать переводы в Python2 и Python3 найти не удалось).
При тестировании 1.4.2 на Xubuntu 14.04 32 bit вылезла ругань на констаны вида u'\u00a9' используемых в двух местах:
 - в окне about - знак копирайта
 - при обновлении списка последних синхронизированных - подменный знак подчеркивания для отключения функции быстрого выбора в GTK меню.
Единственным вариантом задания констант, который сработал в Python2 на 12.04 и в Python3/Python2 на 14.04/15.04 стал unicode константа с Uniсоde символом, скопированная через буфер обмена прямо в код! БРЕД КАКОЙТО!!!
Уже давно напрашивающийся полный переход на Python3 тормозится отсутствием в percise библиотеки pyinotify (поддержка библиотеки inotify ядра) в версии для Python3.
Тянуть совместимость с python2 из-за 12.04 - становится все более накладно.

Решение: создаем на git отдельную ветку с python2 кодом для 12.04 и замораживаем изменения (v.1.4.2, только багфиксы). Развиваемая ветка master преходит полностью на Python3 и не заливается на Launcpad в серию percise, а только в trusty и более новые (из поддерживаемых).
FIXED 1.4.2 percise (Python2) и 1.4.3+ master и dev (Python3)


USER_LOCAL_SETTINGS  (расширение варианта ICONS_AND_FILES_LOCATIONS_STORY)
Добавить пользовательскую конфигурацию файлом в ~/.config/yd-tools 
При этом иконки брать из пользовательского конфига, а если там нет, то из каталога приложения.
FIXED 1.4.2

FILES_LOCATIONS_STORY:
peregrine: «иконка берётся из темы иконок, если она там есть. Если же её там нет, то иконка загружается дефолтная, а куда в системе ты её положишь уже тебе решать.» 
Нужно разобраться с путями в системе (пути к темам и т. п.) И возможно раскидать весь /opt/yd-tools. Но это затронет множество мест в коде.

Вариант (простейший -- 1.4.0-1.4.1):
/opt/yd-tools/yandexDiskIndicator.py        -> /usr/bin/yandex-disk-indicator (вместо bash заглушки)
все из /opt/yd-tools/                       -> /usr/share/yd-tools/ (или /usr/share/yandex-disk-indicator ???)
FIXED 1.4.2

Решение: 
1. меняем:
     installDir = os.path.dirname(os.path.realpath(__file__))  - получает путь где лежит исполняющийся файл.
   на:
     installDir = '/usr/share/yd-tools/' - константа, т. к. исполняемый переползает в /usr/bin/
2. в .desktop файлах меняем пути к иконкам и в .desktop файле индикатора exec=yandex-disk-indicator и path=''
3. заменяем пути к иконкам в файловых расширениях
4. переделываем сборку
.... все остальное - вроде без изменеий
Настройки (dconf) - остаются там же (/usr/share/glib-2.0/schemas/apps.yandex-disk-indicator.gschema.xml)
FIXED 1.4.0 + 1.4.1(п. 3)

NOAUTH_ERROR: (http://forum.ubuntu.ru/index.php?topic=241992.msg1958936#msg1958936)
Не стартует индикатор (v.1.2) когда (на слабом канале) демон не успевает авторизоваться. Видимо идёт какое-то промежуточно сообщение от утилиты (обновлённой яндексом недавно).
Решение: Обработка ошибки старта демона на старте — в случае ошибки предложить запустить индикатор без ожидания запуска демона. fixed

CRASH_CASE:
- Индикатор крашится после саспенда/поверофа, а иногда и просто так ??? при этом часто возникает CAPTURED-LOCK_CASE (HARON_CASE_2)
Причина: точно не установлена
---- вероятно глюк демона (???)
---- в краш репорте что-то про меню проскакивало.... возможно глюк связан с меню последних синхронизированных и тем, что ранее я не отключал там явно опцию use_underline?(возможно коррелирует с MENU-ACCELERATOR_CASE: FIXED) Изменено в 1.1.3 — по факту не помогло :(.
---- Возможно это было связано с асинхронной работой inotify — заменил в 1.1.9 на работу по таймеру — нужно наблюдать.
Решение: переделать с двух-поточной на событийную модель (сделано в 1.1.9).
Результат: тестирование, 03.09.15 — вроде о крашах в последнее время никто не сообщает вероятно помог переход на событийную модель. FIXED ver 1.1.9

CAPTURED-LOCK_CASE (HARON_CASE_2): 
- Одно из последствий CRASH_CASE, а также закрытия сессии пользователя - lock файл индикатора лочится демоном: О!!! БРЕД какой-то!!!
Причина: точно не установлена
---- возможно это как-то связано с запуском yandex-disk status через subprocess.check_output и/или с тем (дополнительно), что там использовалась опция shell=True: убрал shell=True в 1.1.5 смотрим......
Решение: попробовать все причесать вокруг обращений к демону (1.1.5 ).
Результат: по наблюдениям — вроде не повторяется. Не подтверждено.

ACCESS_ERROR_STORY:
Вывод yandex-disk status:
>Статус ядра синхронизации: ошибка
>Ошибка: ошибка доступа
>Путь: 'Документы/работа/акт'
>Путь к папке Яндекс.Диска: '/home/user/Yandex.Disk'
>...
проверил путь - оказалось, по указанному пути лежит битая ссылка.
Индикатор деталей ошибки не дает.
Причина — нет обработки и детализации по этой ошибке
Решение — вывести полный вывод демона в диалоге по клику на статус (сделать его активным пунктом меню). FIXED ver 1.2.0

MENU-ACCELERATOR_CASE: FIXED (1.1.3)
В меню последних синхронизированных не показывается (съедается) символ подчеркивания(_), несмотря на установку <meny_item>set_use_underline(False) (по крайней мере в Xubuntu 12.04 и 13.10). Кроме того, иногда (плавающий глюк) не смотря на установку включается режим когда за подчеркиванием идет акселератор. Бред какой-то просто с этим  use_underline !!!! 
Решение: подмена символа <_> на unicode символ 02CD (hex) 
Результат: FIXED (in 1.1.3)
